<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì‚¬ë‹˜ ìš´í–‰ ì •ë³´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .navigation-btn {
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .navigation-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .student-card {
            border-left: 4px solid #3B82F6;
            transition: all 0.2s ease;
        }
        .student-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .completed {
            border-left-color: #10B981;
            background-color: #F0FDF4;
        }
        .in-progress {
            border-left-color: #F59E0B;
            background-color: #FFFBEB;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-lg mx-auto min-h-screen bg-white">
        <!-- í—¤ë” -->
        <header class="bg-blue-600 text-white p-4 sticky top-0 z-10 shadow-lg">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold">ì˜¤ëŠ˜ì˜ ìš´í–‰ ì •ë³´</h1>
                    <p class="text-sm opacity-90" id="headerInfo">2025ë…„ 8ì›” 7ì¼ / 1í˜¸ì°¨ (ê¹€ê¸°ì‚¬ë‹˜)</p>
                </div>
                <div class="text-right">
                    <div class="text-sm opacity-90">ì§„í–‰ ìƒí™©</div>
                    <div class="text-lg font-bold" id="progressInfo">0/5 ì™„ë£Œ</div>
                </div>
            </div>
        </header>

        <!-- ì „ì²´ ê²½ë¡œ ìš”ì•½ -->
        <div class="p-4 bg-blue-50 border-b">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-sm text-gray-600">ì˜ˆìƒ ì´ ì†Œìš”ì‹œê°„</span>
                    <div class="text-lg font-bold text-blue-600" id="totalTime">45ë¶„</div>
                </div>
                <button id="optimizeBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                    ğŸ“ ê²½ë¡œ ìµœì í™”
                </button>
            </div>
        </div>

        <!-- í•™ìƒ ëª©ë¡ -->
        <main class="p-4">
            <div class="space-y-4" id="studentList">
                <!-- í•™ìƒ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </main>

        <!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ -->
        <div class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-lg bg-white border-t shadow-lg">
            <div class="p-4 grid grid-cols-2 gap-3">
                <button id="emergencyBtn" class="bg-red-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-red-600 transition">
                    ğŸš¨ ê¸´ê¸‰ìƒí™©
                </button>
                <button id="completeBtn" class="bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition">
                    âœ… ìš´í–‰ì™„ë£Œ
                </button>
            </div>
        </div>

        <!-- í•˜ë‹¨ ì—¬ë°± -->
        <div class="h-20"></div>
    </div>

    <!-- ëª¨ë‹¬ - ë„¤ë¹„ê²Œì´ì…˜ ì„ íƒ -->
    <div id="navModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-sm w-full">
                <div class="p-4 border-b">
                    <h3 class="text-lg font-bold">ë„¤ë¹„ê²Œì´ì…˜ ì•± ì„ íƒ</h3>
                    <p class="text-sm text-gray-600 mt-1" id="modalAddress"></p>
                </div>
                <div class="p-4 space-y-3">
                    <button class="nav-option w-full flex items-center p-3 border rounded-lg hover:bg-gray-50 transition" data-type="kakao">
                        <div class="w-10 h-10 bg-yellow-400 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-lg">ğŸ—ºï¸</span>
                        </div>
                        <div class="text-left">
                            <div class="font-medium">ì¹´ì¹´ì˜¤ë‚´ë¹„</div>
                            <div class="text-xs text-gray-500">ì‹¤ì‹œê°„ êµí†µì •ë³´ ë°˜ì˜</div>
                        </div>
                    </button>
                    
                    <button class="nav-option w-full flex items-center p-3 border rounded-lg hover:bg-gray-50 transition" data-type="naver">
                        <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-lg">ğŸ§­</span>
                        </div>
                        <div class="text-left">
                            <div class="font-medium">ë„¤ì´ë²„ì§€ë„</div>
                            <div class="text-xs text-gray-500">ì •í™•í•œ ë„ë¡œ ì •ë³´</div>
                        </div>
                    </button>
                    
                    <button class="nav-option w-full flex items-center p-3 border rounded-lg hover:bg-gray-50 transition" data-type="google">
                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-lg">ğŸŒ</span>
                        </div>
                        <div class="text-left">
                            <div class="font-medium">êµ¬ê¸€ë§µ</div>
                            <div class="text-xs text-gray-500">ê¸€ë¡œë²Œ í‘œì¤€</div>
                        </div>
                    </button>
                    
                    <button class="nav-option w-full flex items-center p-3 border rounded-lg hover:bg-gray-50 transition" data-type="tmap">
                        <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-lg">ğŸš—</span>
                        </div>
                        <div class="text-left">
                            <div class="font-medium">í‹°ë§µ</div>
                            <div class="text-xs text-gray-500">ì •ë°€í•œ ë‚´ë¹„ê²Œì´ì…˜</div>
                        </div>
                    </button>
                </div>
                <div class="p-4 border-t">
                    <button id="closeModal" class="w-full py-2 text-gray-600 hover:text-gray-800 transition">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒ˜í”Œ ë°ì´í„°
        const routeData = {
            driver: 'ê¹€ê¸°ì‚¬',
            vehicle: '1í˜¸ì°¨',
            date: '2025ë…„ 8ì›” 7ì¼',
            timeSlot: '07:00',
            students: [
                {
                    id: 1,
                    name: 'ê¹€ë¯¼ìˆ˜',
                    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ë™ì²œë™ 123-45',
                    phone: '010-1234-5678',
                    status: 'pending', // pending, in-progress, completed
                    estimatedTime: 8,
                    pickupOrder: 1
                },
                {
                    id: 2,
                    name: 'ì´ì†Œì˜',
                    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ì˜ë•ë™ 67-89',
                    phone: '010-2345-6789',
                    status: 'pending',
                    estimatedTime: 5,
                    pickupOrder: 2
                },
                {
                    id: 3,
                    name: 'ë°•ì •í˜¸',
                    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ë³´ì •ë™ 111-22',
                    phone: '010-3456-7890',
                    status: 'pending',
                    estimatedTime: 7,
                    pickupOrder: 3
                },
                {
                    id: 4,
                    name: 'ê°•ì§€ìš°',
                    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ë™ì²œë™ 222-33',
                    phone: '010-4567-8901',
                    status: 'pending',
                    estimatedTime: 6,
                    pickupOrder: 4
                },
                {
                    id: 5,
                    name: 'ìœ¤ì„œì—°',
                    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ì£½ì „ë™ 333-44',
                    phone: '010-5678-9012',
                    status: 'pending',
                    estimatedTime: 9,
                    pickupOrder: 5
                }
            ]
        };

        let currentAddress = '';

        // ì´ˆê¸°í™”
        function initialize() {
            updateHeader();
            renderStudentList();
            updateProgress();
        }

        // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
        function updateHeader() {
            document.getElementById('headerInfo').textContent = 
                `${routeData.date} / ${routeData.vehicle} (${routeData.driver}ë‹˜)`;
        }

        // í•™ìƒ ëª©ë¡ ë Œë”ë§
        function renderStudentList() {
            const container = document.getElementById('studentList');
            container.innerHTML = '';

            routeData.students
                .sort((a, b) => a.pickupOrder - b.pickupOrder)
                .forEach((student, index) => {
                    const card = createStudentCard(student, index);
                    container.appendChild(card);
                });
        }

        // í•™ìƒ ì¹´ë“œ ìƒì„±
        function createStudentCard(student, index) {
            const card = document.createElement('div');
            card.className = `student-card bg-white p-4 rounded-lg shadow-md ${getStatusClass(student.status)}`;
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mr-3">
                            ${student.pickupOrder}
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">${student.name}</h3>
                            <p class="text-sm text-gray-600">${student.phone}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-500">ì˜ˆìƒì‹œê°„</div>
                        <div class="font-bold text-blue-600">${student.estimatedTime}ë¶„</div>
                    </div>
                </div>
                
                <p class="text-sm text-gray-700 mb-4 leading-relaxed">${student.address}</p>
                
                <div class="flex gap-2">
                    <button onclick="openNavigation('${student.address}')" 
                            class="navigation-btn flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg font-medium hover:bg-blue-700 transition flex items-center justify-center">
                        ğŸ§­ ë„¤ë¹„ê²Œì´ì…˜
                    </button>
                    <button onclick="callStudent('${student.phone}')" 
                            class="navigation-btn bg-green-600 text-white py-2 px-3 rounded-lg font-medium hover:bg-green-700 transition">
                        ğŸ“
                    </button>
                    <button onclick="toggleStatus(${student.id})" 
                            class="navigation-btn ${getActionButtonClass(student.status)} py-2 px-3 rounded-lg font-medium transition">
                        ${getActionButtonText(student.status)}
                    </button>
                </div>
            `;

            return card;
        }

        // ìƒíƒœë³„ í´ë˜ìŠ¤
        function getStatusClass(status) {
            switch(status) {
                case 'completed': return 'completed';
                case 'in-progress': return 'in-progress';
                default: return '';
            }
        }

        function getActionButtonClass(status) {
            switch(status) {
                case 'completed': return 'bg-gray-400 text-white cursor-not-allowed';
                case 'in-progress': return 'bg-green-600 text-white hover:bg-green-700';
                default: return 'bg-orange-500 text-white hover:bg-orange-600';
            }
        }

        function getActionButtonText(status) {
            switch(status) {
                case 'completed': return 'âœ…';
                case 'in-progress': return 'ì™„ë£Œ';
                default: return 'ì¶œë°œ';
            }
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ëª¨ë‹¬ ì—´ê¸°
        function openNavigation(address) {
            currentAddress = address;
            document.getElementById('modalAddress').textContent = address;
            document.getElementById('navModal').classList.remove('hidden');
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ì•± ì‹¤í–‰
        function launchNavigation(type, address) {
            const encodedAddress = encodeURIComponent(address);
            let url = '';

            switch(type) {
                case 'kakao':
                    // ì¹´ì¹´ì˜¤ë‚´ë¹„ ì•± ìŠ¤í‚´
                    url = `kakaomap://route?ep=${encodedAddress}&by=CAR`;
                    break;
                case 'naver':
                    // ë„¤ì´ë²„ì§€ë„ ì•± ìŠ¤í‚´
                    url = `nmap://route/public?dlat=&dlng=&dname=${encodedAddress}&appname=joypool`;
                    break;
                case 'google':
                    // êµ¬ê¸€ë§µ
                    url = `https://maps.google.com/maps?daddr=${encodedAddress}`;
                    break;
                case 'tmap':
                    // í‹°ë§µ
                    url = `tmap://route?goalname=${encodedAddress}`;
                    break;
            }

            // ì•± ì‹¤í–‰ ì‹œë„
            const link = document.createElement('a');
            link.href = url;
            link.target = '_blank';
            
            // ëª¨ë°”ì¼ì—ì„œ ì•± ìŠ¤í‚´ ì‹¤í–‰
            if (type === 'kakao' || type === 'naver' || type === 'tmap') {
                try {
                    link.click();
                } catch (e) {
                    // ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš° ì›¹ ë²„ì „ìœ¼ë¡œ í´ë°±
                    if (type === 'kakao') {
                        window.open(`https://map.kakao.com/link/to/${encodedAddress}`, '_blank');
                    } else if (type === 'naver') {
                        window.open(`https://map.naver.com/v5/directions/-/-/-/car?c=14.00,0,0,0,dh`, '_blank');
                    }
                }
            } else {
                link.click();
            }

            closeModal();
        }

        // ì „í™” ê±¸ê¸°
        function callStudent(phone) {
            window.location.href = `tel:${phone}`;
        }

        // í•™ìƒ ìƒíƒœ ë³€ê²½
        function toggleStatus(studentId) {
            const student = routeData.students.find(s => s.id === studentId);
            if (!student || student.status === 'completed') return;

            if (student.status === 'pending') {
                student.status = 'in-progress';
            } else if (student.status === 'in-progress') {
                student.status = 'completed';
            }

            renderStudentList();
            updateProgress();
        }

        // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        function updateProgress() {
            const completed = routeData.students.filter(s => s.status === 'completed').length;
            const total = routeData.students.length;
            
            document.getElementById('progressInfo').textContent = `${completed}/${total} ì™„ë£Œ`;
            
            // ì´ ì†Œìš”ì‹œê°„ ì—…ë°ì´íŠ¸
            const remainingTime = routeData.students
                .filter(s => s.status !== 'completed')
                .reduce((sum, s) => sum + s.estimatedTime, 0);
            
            document.getElementById('totalTime').textContent = `${remainingTime}ë¶„`;
        }

        // ê²½ë¡œ ìµœì í™”
        function optimizeRoute() {
            // ë¯¸ì™„ë£Œ í•™ìƒë“¤ì„ ê±°ë¦¬ìˆœìœ¼ë¡œ ì¬ì •ë ¬ (ì‹œë®¬ë ˆì´ì…˜)
            const pendingStudents = routeData.students.filter(s => s.status === 'pending');
            
            if (pendingStudents.length <= 1) {
                alert('ìµœì í™”í•  ê²½ë¡œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ê°„ë‹¨í•œ ìµœì í™” ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì§€ë„ API ì‚¬ìš©)
            pendingStudents.sort(() => Math.random() - 0.5);
            
            let order = 1;
            routeData.students.forEach(student => {
                if (student.status !== 'pending') return;
                student.pickupOrder = order++;
            });

            renderStudentList();
            
            alert('ê²½ë¡œê°€ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\nì˜ˆìƒ ì†Œìš”ì‹œê°„ì´ ë‹¨ì¶•ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }

        // ê¸´ê¸‰ìƒí™© ì‹ ê³ 
        function reportEmergency() {
            const confirmed = confirm('ê¸´ê¸‰ìƒí™©ì„ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë¦¬ìì—ê²Œ ì¦‰ì‹œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.');
            
            if (confirmed) {
                alert('ê¸´ê¸‰ìƒí™©ì´ ì‹ ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìê°€ ê³§ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.');
                
                // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ì„œë²„ë¡œ ê¸´ê¸‰ìƒí™© ì „ì†¡
                console.log('Emergency reported:', {
                    driver: routeData.driver,
                    vehicle: routeData.vehicle,
                    timestamp: new Date().toISOString(),
                    location: 'Current GPS location'
                });
            }
        }

        // ìš´í–‰ ì™„ë£Œ
        function completeRoute() {
            const completed = routeData.students.filter(s => s.status === 'completed').length;
            const total = routeData.students.length;
            
            if (completed < total) {
                alert(`ì•„ì§ ${total - completed}ëª…ì˜ í•™ìƒì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.\nëª¨ë“  í•™ìƒì„ íƒœìš´ í›„ ì™„ë£Œí•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            const confirmed = confirm('ëª¨ë“  í•™ìƒ í”½ì—…ì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?\nìš´í–‰ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
            
            if (confirmed) {
                alert('ìš´í–‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!');
                
                // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ì„œë²„ì— ì™„ë£Œ ìƒíƒœ ì „ì†¡
                console.log('Route completed:', {
                    driver: routeData.driver,
                    vehicle: routeData.vehicle,
                    completedAt: new Date().toISOString(),
                    studentsPickedUp: total
                });
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('navModal').classList.add('hidden');
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            initialize();
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì˜µì…˜ í´ë¦­
            document.querySelectorAll('.nav-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    const type = btn.dataset.type;
                    launchNavigation(type, currentAddress);
                });
            });
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('optimizeBtn').addEventListener('click', optimizeRoute);
            document.getElementById('emergencyBtn').addEventListener('click', reportEmergency);
            document.getElementById('completeBtn').addEventListener('click', completeRoute);
            document.getElementById('closeModal').addEventListener('click', closeModal);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('navModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeModal();
                }
            });
        });

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ì¸ë¼ì¸ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ìš©)
        window.openNavigation = openNavigation;
        window.callStudent = callStudent;
        window.toggleStatus = toggleStatus;
    </script>
</body>
</html>