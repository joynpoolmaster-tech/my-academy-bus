<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš— ê¸°ì‚¬ë‹˜ ìŠ¤ë§ˆíŠ¸ ë‚´ë¹„ê²Œì´ì…˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            user-select: none;
            -webkit-user-select: none;
        }
        .nav-btn {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .nav-btn:active {
            transform: translateY(0px);
            transition: all 0.1s ease;
        }
        .student-card {
            border-left: 5px solid #3B82F6;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .student-card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        .completed {
            border-left-color: #10B981;
            background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
        }
        .current {
            border-left-color: #F59E0B;
            background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5); }
        }
        .progress-bar {
            transition: width 0.8s ease;
        }
        .floating-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .route-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .navi-modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.8);
        }
        .bounce-in {
            animation: bounceIn 0.5s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .nav-option {
            transition: all 0.3s ease;
            border-radius: 16px;
            background: white;
            border: 2px solid transparent;
        }
        .nav-option:hover {
            border-color: #3B82F6;
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- í—¤ë” -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 sticky top-0 z-50 shadow-xl">
        <div class="max-w-lg mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold flex items-center">
                        ğŸš— ìŠ¤ë§ˆíŠ¸ ë‚´ë¹„ê²Œì´ì…˜
                        <span class="ml-2 px-2 py-1 bg-white/20 rounded-full text-xs">LIVE</span>
                    </h1>
                    <p class="text-sm opacity-90" id="headerInfo">2025ë…„ 8ì›” 7ì¼ / 1í˜¸ì°¨ (ê¹€ê¸°ì‚¬ë‹˜)</p>
                </div>
                <div class="text-right">
                    <div class="text-xs opacity-90">ì§„í–‰ë¥ </div>
                    <div class="text-lg font-bold" id="progressInfo">0/5</div>
                </div>
            </div>
            <!-- ì§„í–‰ë¥  ë°” -->
            <div class="mt-3 bg-white/20 rounded-full h-2 overflow-hidden">
                <div class="progress-bar bg-white h-full rounded-full" style="width: 0%" id="progressBar"></div>
            </div>
        </div>
    </header>

    <div class="max-w-lg mx-auto">
        <!-- ê²½ë¡œ ìš”ì•½ ì¹´ë“œ -->
        <div class="route-summary text-white p-6 m-4 rounded-2xl shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-sm opacity-90">ì˜ˆìƒ ì†Œìš”ì‹œê°„</div>
                    <div class="text-3xl font-bold" id="totalTime">45ë¶„</div>
                </div>
                <div class="text-right">
                    <div class="text-sm opacity-90">ì´ ê±°ë¦¬</div>
                    <div class="text-xl font-bold" id="totalDistance">12.5km</div>
                </div>
            </div>
            <div class="mt-4 flex space-x-3">
                <button onclick="optimizeRoute()" class="flex-1 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-xl px-4 py-2 text-sm font-medium transition">
                    ğŸ“ ê²½ë¡œ ìµœì í™”
                </button>
                <button onclick="startNavigation()" class="flex-1 bg-yellow-500 hover:bg-yellow-400 text-black rounded-xl px-4 py-2 text-sm font-bold transition">
                    ğŸš€ ì „ì²´ ì¶œë°œ
                </button>
            </div>
        </div>

        <!-- í•™ìƒ ëª©ë¡ -->
        <div class="p-4 space-y-4" id="studentList">
            <!-- í•™ìƒ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ì»¨íŠ¸ë¡¤ -->
    <div class="floating-controls">
        <button onclick="emergencyCall()" class="bg-red-500 hover:bg-red-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center mb-3 transition">
            ğŸš¨
        </button>
        <button onclick="toggleGPS()" class="bg-green-500 hover:bg-green-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition" id="gpsBtn">
            ğŸ“
        </button>
    </div>

    <!-- ë‚´ë¹„ê²Œì´ì…˜ ì„ íƒ ëª¨ë‹¬ -->
    <div id="naviModal" class="navi-modal fixed inset-0 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full mx-4 bounce-in">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="text-4xl mb-2">ğŸ—ºï¸</div>
                    <h3 class="text-xl font-bold text-gray-800">ë‚´ë¹„ê²Œì´ì…˜ ì„ íƒ</h3>
                    <p class="text-sm text-gray-600 mt-1" id="selectedStudent">í™ê¸¸ë™ë‹˜ ì§‘ìœ¼ë¡œ ì•ˆë‚´</p>
                </div>
                
                <div class="space-y-3" id="naviOptions">
                    <!-- ë‚´ë¹„ê²Œì´ì…˜ ì˜µì…˜ë“¤ -->
                </div>
                
                <button onclick="closeNaviModal()" class="w-full mt-6 py-3 text-gray-600 hover:text-gray-800 transition font-medium">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>

    <!-- ì™„ë£Œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="completeModal" class="navi-modal fixed inset-0 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full mx-4 bounce-in">
            <div class="p-6 text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">í”½ì—… ì™„ë£Œ!</h3>
                <p class="text-gray-600 mb-6" id="completedStudentName">í™ê¸¸ë™ë‹˜ì„ í”½ì—…í–ˆìŠµë‹ˆë‹¤</p>
                <div class="flex space-x-3">
                    <button onclick="closeCompleteModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-medium transition">
                        ì·¨ì†Œ
                    </button>
                    <button onclick="confirmComplete()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold transition">
                        ì™„ë£Œ í™•ì¸
                    </button>
                </div>
            </div>
        </div>
    </div>

        let currentStudentIndex = 0;
        let selectedStudentForNavi = null;
        let gpsEnabled = false;

        // ë‚´ë¹„ê²Œì´ì…˜ ì•± ì •ë³´
        const naviApps = [
            {
                name: 'ì¹´ì¹´ì˜¤ë„¤ë¹„',
                icon: 'ğŸŸ¨',
                scheme: 'kakaonavi://route?destination=',
                fallback: 'https://map.kakao.com/link/to/',
                description: 'ì‹¤ì‹œê°„ êµí†µì •ë³´'
            },
            {
                name: 'ë„¤ì´ë²„ì§€ë„',
                icon: 'ğŸŸ¢',
                scheme: 'nmap://route/walk?dlat={lat}&dlng={lng}&dname=',
                fallback: 'https://map.naver.com/v5/search/',
                description: 'ì •í™•í•œ ë„ë¡œì •ë³´'
            },
            {
                name: 'êµ¬ê¸€ë§µ',
                icon: 'ğŸ”µ',
                scheme: 'comgooglemaps://?daddr=',
                fallback: 'https://maps.google.com/maps?q=',
                description: 'ê¸€ë¡œë²Œ í‘œì¤€'
            },
            {
                name: 'í‹°ë§µ',
                icon: 'ğŸ”´',
                scheme: 'tmap://route?goalname=ëª©ì ì§€&goalx={lng}&goaly={lat}',
                fallback: 'https://www.tmap.co.kr',
                description: 'ì •ë°€í•œ ë‚´ë¹„ê²Œì´ì…˜'
            },
            {
                name: 'ì• í”Œë§µ',
                icon: 'ğŸ',
                scheme: 'http://maps.apple.com/?daddr=',
                fallback: 'http://maps.apple.com/?q=',
                description: 'iOS ê¸°ë³¸ ë‚´ë¹„'
            }
        ];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentList();
            updateProgress();
            updateHeaderInfo();
            
            // í˜„ì¬ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        gpsEnabled = true;
                        updateGPSButton();
                        console.log('GPS í™œì„±í™”ë¨');
                    },
                    error => {
                        console.log('GPS ê¶Œí•œ ê±°ë¶€ë¨');
                    }
                );
            }
        });

        // í•™ìƒ ëª©ë¡ ë Œë”ë§
        function renderStudentList() {
            const container = document.getElementById('studentList');
            container.innerHTML = '';

            routeData.students.forEach((student, index) => {
                const isCompleted = student.status === 'completed';
                const isCurrent = student.status === 'current' || (currentStudentIndex === index && student.status === 'pending');
                
                if (isCurrent && student.status !== 'current') {
                    student.status = 'current';
                }

                const cardClass = isCompleted ? 'completed' : (isCurrent ? 'current' : '');
                const statusIcon = isCompleted ? 'âœ…' : (isCurrent ? 'ğŸš—' : 'â±ï¸');
                const statusText = isCompleted ? 'ì™„ë£Œ' : (isCurrent ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°ì¤‘');

                const card = document.createElement('div');
                card.className = `student-card bg-white p-5 rounded-2xl shadow-lg ${cardClass}`;
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center flex-1">
                            <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
                                ${index + 1}
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <h3 class="font-bold text-lg text-gray-800">${student.name}</h3>
                                    <span class="ml-2 text-sm">${statusIcon}</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${student.address}</p>
                                <div class="flex items-center mt-2 space-x-4">
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">ğŸ“ ${student.distance}</span>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">â±ï¸ ${student.estimatedTime}</span>
                                    <span class="text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded-full">${statusText}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex space-x-2">
                        ${!isCompleted ? `
                            <button onclick="openNavigation(${student.id})" class="nav-btn flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 rounded-xl transition">
                                ğŸ—ºï¸ ê¸¸ì°¾ê¸°
                            </button>
                            <button onclick="callStudent('${student.phone}')" class="nav-btn bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-xl transition">
                                ğŸ“
                            </button>
                            ${isCurrent ? `
                                <button onclick="completePickup(${student.id})" class="nav-btn bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-xl transition">
                                    âœ…
                                </button>
                            ` : ''}
                        ` : `
                            <div class="flex-1 bg-green-100 text-green-800 py-3 rounded-xl text-center font-medium">
                                âœ… í”½ì—… ì™„ë£Œ
                            </div>
                        `}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // ë‚´ë¹„ê²Œì´ì…˜ ì•± ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
        function openNavigation(studentId) {
            selectedStudentForNavi = routeData.students.find(s => s.id === studentId);
            if (!selectedStudentForNavi) return;

            document.getElementById('selectedStudent').textContent = `${selectedStudentForNavi.name}ë‹˜ ì§‘ìœ¼ë¡œ ì•ˆë‚´`;
            
            const optionsContainer = document.getElementById('naviOptions');
            optionsContainer.innerHTML = '';

            naviApps.forEach(app => {
                const option = document.createElement('button');
                option.className = 'nav-option w-full flex items-center p-4 transition';
                option.onclick = () => launchNavigation(app);
                
                option.innerHTML = `
                    <div class="w-12 h-12 flex items-center justify-center text-2xl mr-4">
                        ${app.icon}
                    </div>
                    <div class="text-left flex-1">
                        <div class="font-bold text-gray-800">${app.name}</div>
                        <div class="text-sm text-gray-600">${app.description}</div>
                    </div>
                    <div class="text-blue-500 font-bold">ì‹¤í–‰</div>
                `;
                
                optionsContainer.appendChild(option);
            });

            document.getElementById('naviModal').classList.remove('hidden');
        }

        // ë‚´ë¹„ê²Œì´ì…˜ ì•± ì‹¤í–‰
        function launchNavigation(app) {
            if (!selectedStudentForNavi) return;

            const address = selectedStudentForNavi.address;
            let url;

            try {
                // ì•± ìŠ¤í‚´ìœ¼ë¡œ ì‹œë„
                if (app.name === 'ì¹´ì¹´ì˜¤ë„¤ë¹„') {
                    url = app.scheme + encodeURIComponent(address);
                } else if (app.name === 'ë„¤ì´ë²„ì§€ë„') {
                    url = app.fallback + encodeURIComponent(address);
                } else if (app.name === 'êµ¬ê¸€ë§µ') {
                    url = app.fallback + encodeURIComponent(address);
                } else if (app.name === 'í‹°ë§µ') {
                    url = app.fallback;
                } else if (app.name === 'ì• í”Œë§µ') {
                    url = app.scheme + encodeURIComponent(address);
                }

                // ì•± ì‹¤í–‰ ì‹œë„
                window.location.href = url;
                
                // ì ì‹œ í›„ í´ë°± URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš°)
                setTimeout(() => {
                    if (app.fallback && app.fallback !== url) {
                        window.open(app.fallback + encodeURIComponent(address), '_blank');
                    }
                }, 1000);

                closeNaviModal();
                
                // ì§„ë™ í”¼ë“œë°± (ì§€ì›í•˜ëŠ” ê¸°ê¸°ì—ì„œ)
                if (navigator.vibrate) {
                    navigator.vibrate(200);
                }

                showToast(`${app.name}ìœ¼ë¡œ ${selectedStudentForNavi.name}ë‹˜ ì§‘ ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤! ğŸš—`);

            } catch (error) {
                console.error('ë‚´ë¹„ê²Œì´ì…˜ ì‹¤í–‰ ì˜¤ë¥˜:', error);
                showToast('ë‚´ë¹„ê²Œì´ì…˜ ì•±ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // í•™ìƒì—ê²Œ ì „í™”ê±¸ê¸°
        function callStudent(phone) {
            if (confirm(`${phone}ë¡œ ì „í™”ë¥¼ ê±¸ê¹Œìš”?`)) {
                window.location.href = `tel:${phone}`;
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }

        // í”½ì—… ì™„ë£Œ ì²˜ë¦¬
        function completePickup(studentId) {
            const student = routeData.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('completedStudentName').textContent = `${student.name}ë‹˜ì„ í”½ì—…í–ˆìŠµë‹ˆë‹¤`;
            document.getElementById('completeModal').classList.remove('hidden');
        }

        // í”½ì—… ì™„ë£Œ í™•ì¸
        function confirmComplete() {
            const student = routeData.students.find(s => s.status === 'current');
            if (student) {
                student.status = 'completed';
                currentStudentIndex++;
                
                renderStudentList();
                updateProgress();
                
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                showToast(`${student.name}ë‹˜ í”½ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰`);
                
                // ë‹¤ìŒ í•™ìƒìœ¼ë¡œ ìë™ ì´ë™
                if (currentStudentIndex < routeData.students.length) {
                    setTimeout(() => {
                        const nextStudent = routeData.students[currentStudentIndex];
                        showToast(`ë‹¤ìŒ ëª©ì ì§€: ${nextStudent.name}ë‹˜ (${nextStudent.estimatedTime})`, 'info');
                    }, 2000);
                } else {
                    setTimeout(() => {
                        showToast('ğŸ‰ ëª¨ë“  í”½ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!', 'success');
                    }, 2000);
                }
            }
            
            closeCompleteModal();
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const completed = routeData.students.filter(s => s.status === 'completed').length;
            const total = routeData.students.length;
            const percentage = (completed / total) * 100;
            
            document.getElementById('progressInfo').textContent = `${completed}/${total}`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
        function updateHeaderInfo() {
            document.getElementById('headerInfo').textContent = 
                `${routeData.date} / ${routeData.vehicle} (${routeData.driver}ë‹˜)`;
        }

        // ê²½ë¡œ ìµœì í™”
        function optimizeRoute() {
            showToast('ê²½ë¡œë¥¼ ìµœì í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤... ğŸ”„');
            
            // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ìµœì í™”ëœ ê²½ë¡œë¥¼ ë°›ì•„ì˜´
            setTimeout(() => {
                showToast('ê²½ë¡œ ìµœì í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì•½ 8ë¶„ ë‹¨ì¶• ì˜ˆìƒ âš¡', 'success');
                document.getElementById('totalTime').textContent = '37ë¶„';
            }, 2000);
        }

        // ì „ì²´ ê²½ë¡œ ì‹œì‘
        function startNavigation() {
            if (routeData.students.filter(s => s.status === 'pending' || s.status === 'current').length === 0) {
                showToast('ëª¨ë“  í”½ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                return;
            }
            
            const firstPendingStudent = routeData.students.find(s => s.status === 'pending' || s.status === 'current');
            if (firstPendingStudent) {
                openNavigation(firstPendingStudent.id);
            }
        }

        // ì‘ê¸‰ìƒí™© ì²˜ë¦¬
        function emergencyCall() {
            if (confirm('ì‘ê¸‰ìƒí™©ì…ë‹ˆë‹¤. ê´€ë¦¬ì„¼í„°ì— ì—°ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = 'tel:02-1234-5678';
                showToast('ê´€ë¦¬ì„¼í„°ì— ì—°ê²° ì¤‘ì…ë‹ˆë‹¤... ğŸš¨', 'error');
            }
        }

        // GPS í† ê¸€
        function toggleGPS() {
            if (gpsEnabled) {
                // GPS í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            showToast(`í˜„ì¬ ìœ„ì¹˜: ${lat.toFixed(6)}, ${lng.toFixed(6)} ğŸ“`);
                        },
                        error => {
                            showToast('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                        }
                    );
                }
            } else {
                showToast('GPS ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // GPS ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateGPSButton() {
            const btn = document.getElementById('gpsBtn');
            if (gpsEnabled) {
                btn.classList.remove('bg-gray-400');
                btn.classList.add('bg-green-500', 'hover:bg-green-600');
            } else {
                btn.classList.remove('bg-green-500', 'hover:bg-green-600');
                btn.classList.add('bg-gray-400');
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ë“¤
        function closeNaviModal() {
            document.getElementById('naviModal').classList.add('hidden');
            selectedStudentForNavi = null;
        }

        function closeCompleteModal() {
            document.getElementById('completeModal').classList.add('hidden');
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : 
                           type === 'success' ? 'bg-green-500' : 
                           'bg-blue-500';
            
            toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-full shadow-lg z-50 transition-all duration-300 opacity-0`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            if (event.target.id === 'naviModal') {
                closeNaviModal();
            }
            if (event.target.id === 'completeModal') {
                closeCompleteModal();
            }
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeNaviModal();
                closeCompleteModal();
            }
        });

        // PWA ê´€ë ¨ ê¸°ëŠ¥
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            showToast('ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì—¬ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”! ğŸ“±');
        });

        // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ê°ì§€ (ë°±ê·¸ë¼ìš´ë“œ/í¬ê·¸ë¼ìš´ë“œ)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('ì•±ì´ ë°±ê·¸ë¼ìš´ë“œë¡œ ì´ë™ë¨');
            } else {
                console.log('ì•±ì´ í¬ê·¸ë¼ìš´ë“œë¡œ ë³µê·€ë¨');
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                updateProgress();
            }
        });

        // ë°°í„°ë¦¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ì§€ì›í•˜ëŠ” ê¸°ê¸°ì—ì„œ)
        if ('getBattery' in navigator) {
            navigator.getBattery().then(function(battery) {
                if (battery.level < 0.2) {
                    showToast('ë°°í„°ë¦¬ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ì¶©ì „ê¸°ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš” ğŸ”‹', 'error');
                }
            });
        }

        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        window.addEventListener('online', function() {
            showToast('ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŒ', 'success');
        });

        window.addEventListener('offline', function() {
            showToast('ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ğŸ“µ', 'error');
        });

        // í™”ë©´ ë°©í–¥ ë³€ê²½ ê°ì§€
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                renderStudentList(); // í™”ë©´ ë°©í–¥ ë³€ê²½ í›„ ë ˆì´ì•„ì›ƒ ì¬ì¡°ì •
            }, 500);
        });

        // í„°ì¹˜ ì œìŠ¤ì²˜ (ìŠ¤ì™€ì´í”„ë¡œ ë‹¤ìŒ/ì´ì „ í•™ìƒ)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 100;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ë‹¤ìŒ í•™ìƒ
                    goToNextStudent();
                } else {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ì´ì „ í•™ìƒ
                    goToPreviousStudent();
                }
            }
        }

        function goToNextStudent() {
            if (currentStudentIndex < routeData.students.length - 1) {
                const currentStudent = routeData.students[currentStudentIndex];
                if (currentStudent.status === 'current') {
                    currentStudent.status = 'completed';
                }
                currentStudentIndex++;
                renderStudentList();
                updateProgress();
                
                const nextStudent = routeData.students[currentStudentIndex];
                showToast(`ë‹¤ìŒ: ${nextStudent.name}ë‹˜ ğŸ“`);
            }
        }

        function goToPreviousStudent() {
            if (currentStudentIndex > 0) {
                const currentStudent = routeData.students[currentStudentIndex];
                if (currentStudent.status === 'current') {
                    currentStudent.status = 'pending';
                }
                currentStudentIndex--;
                
                const prevStudent = routeData.students[currentStudentIndex];
                prevStudent.status = 'current';
                
                renderStudentList();
                updateProgress();
                showToast(`ì´ì „: ${prevStudent.name}ë‹˜ ğŸ“`);
            }
        }

        // ìŒì„± ì•ˆë‚´ ê¸°ëŠ¥ (Web Speech API)
        function speakMessage(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                speechSynthesis.speak(utterance);
            }
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
        setInterval(function() {
            // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë²„ì—ì„œ ìµœì‹  ë°°ì°¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
            console.log('ë°ì´í„° ë™ê¸°í™” ì¤‘...');
        }, 30000); // 30ì´ˆë§ˆë‹¤

        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ì˜¤í”„ë¼ì¸ ì§€ì›)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }

        // ê¸´ê¸‰ ìƒí™©ìš© SOS ê¸°ëŠ¥
        let sosClickCount = 0;
        let sosTimer;

        function activateSOS() {
            sosClickCount++;
            clearTimeout(sosTimer);
            
            if (sosClickCount === 1) {
                showToast('SOS ëª¨ë“œ: 3ì´ˆ ì•ˆì— 3ë²ˆ ë” ëˆ„ë¥´ë©´ ê¸´ê¸‰í˜¸ì¶œë©ë‹ˆë‹¤!', 'error');
            }
            
            if (sosClickCount >= 3) {
                // ê¸´ê¸‰ í˜¸ì¶œ ì‹¤í–‰
                showToast('ğŸš¨ ê¸´ê¸‰ ìƒí™©! ê´€ë¦¬ì„¼í„°ì— ìë™ ì—°ê²°ë©ë‹ˆë‹¤!', 'error');
                window.location.href = 'tel:119';
                sosClickCount = 0;
                return;
            }
            
            sosTimer = setTimeout(() => {
                sosClickCount = 0;
            }, 3000);
        }

        // í™”ë©´ í•­ìƒ ì¼œë‘ê¸° (Wake Lock API)
        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('í™”ë©´ êº¼ì§ ë°©ì§€ í™œì„±í™”');
                }
            } catch (err) {
                console.log('Wake Lock ì˜¤ë¥˜:', err);
            }
        }

        // ì•± ì‹œì‘ì‹œ í™”ë©´ ì¼œë‘ê¸° ìš”ì²­
        requestWakeLock();

        // í˜ì´ì§€ í¬ì»¤ìŠ¤ ì‹œ Wake Lock ì¬ìš”ì²­
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                await requestWakeLock();
            }
        });

        // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì‹œì‘/ì¤‘ì§€
        let watchId = null;

        function startLocationTracking() {
            if (navigator.geolocation) {
                watchId = navigator.geolocation.watchPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        console.log(`ì‹¤ì‹œê°„ ìœ„ì¹˜: ${lat}, ${lng}`);
                        // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ìœ„ì¹˜ ì •ë³´ ì „ì†¡
                    },
                    error => {
                        console.log('ìœ„ì¹˜ ì¶”ì  ì˜¤ë¥˜:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            }
        }

        function stopLocationTracking() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }

        // ìë™ìœ¼ë¡œ ìœ„ì¹˜ ì¶”ì  ì‹œì‘
        if (gpsEnabled) {
            startLocationTracking();
        }

        // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        if ('Notification' in window) {
            if (Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showToast('ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“¢');
                    }
                });
            }
        }

        // í‘¸ì‹œ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showNotification(title, body, icon = 'ğŸš—') {
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '/icon-192x192.png',
                    badge: '/badge-72x72.png',
                    tag: 'driver-notification',
                    requireInteraction: true
                });
            }
        }

        // ì˜ˆì œ: ë‹¤ìŒ ëª©ì ì§€ ë„ì°© ì•Œë¦¼
        function notifyArrival(studentName) {
            showNotification(
                'ëª©ì ì§€ ë„ì°©!',
                `${studentName}ë‹˜ ì§‘ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. í”½ì—…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.`,
                'ğŸ“'
            );
            
            // ì§„ë™ë„ í•¨ê»˜
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        // ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ (ê¸¸ê²Œ ëˆŒë €ì„ ë•Œ)
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showToast('ğŸ”§ ê°œë°œì ë„êµ¬ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        });

        // ë”ë¸”íƒ­ìœ¼ë¡œ í™•ëŒ€/ì¶•ì†Œ ë°©ì§€
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ (ê°œë°œìš©)
        setInterval(() => {
            if (performance.memory) {
                const used = Math.round(performance.memory.usedJSHeapSize / 1048576);
                if (used > 50) { // 50MB ì´ìƒì‹œ ê²½ê³ 
                    console.warn(`ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${used}MB`);
                }
            }
        }, 60000);

        console.log('ğŸš— ìŠ¤ë§ˆíŠ¸ ë‚´ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œì´ ì™„ì „íˆ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        showToast('ğŸš— ìŠ¤ë§ˆíŠ¸ ë‚´ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œ ì¤€ë¹„ì™„ë£Œ!', 'success');