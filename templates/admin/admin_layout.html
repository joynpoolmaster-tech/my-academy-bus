<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 각 페이지의 제목이 동적으로 변경됩니다 -->
    <title>{% block title %}관리자 페이지{% endblock %} - JOY & POOL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 모든 관리자 페이지의 공통 스타일을 한 곳에서 관리합니다 -->
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .admin-sidebar-bg { background-color: #F0F9FF; }
        .admin-header-bg { background-color: #E0F2FE; }
        .expiring-soon { background-color: #FEF9C3; }
    </style>
</head>
<body class="bg-gray-100 flex">

    <!-- 사이드바 -->
    <div class="admin-sidebar-bg w-64 min-h-screen p-4 hidden md:block">
        <!-- 로그인한 사용자의 역할에 따라 제목이 바뀝니다 -->
        {% if session.get('role') == 'master' %}
        <div class="text-2xl font-bold text-blue-800 mb-8">마스터 시스템</div>
        {% else %}
        <div class="text-2xl font-bold text-blue-800 mb-8">배차 관리 시스템</div>
        {% endif %}
        
        <!-- 모든 관리자/마스터 페이지에 공통으로 적용될 통합 사이드바 -->
        <nav class="space-y-2">
            <!-- 마스터 전용 메뉴 -->
            {% if session.get('role') == 'master' %}
            <a href="{{ url_for('manage_branches') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'manage_branches' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                지점/관리자 관리
            </a>
            {% endif %}
        
            <!-- 관리자 공용 메뉴 -->
            <a href="{{ url_for('admin_dashboard') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'admin_dashboard' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                대시보드
            </a>
            <a href="{{ url_for('manage_students') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'manage_students' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                회원 관리
            </a>
            <a href="{{ url_for('manage_classes') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'manage_classes' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                클래스 관리
            </a>
            <a href="{{ url_for('manage_vehicles') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'manage_vehicles' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                기사/차량 관리
            </a>
            <a href="{{ url_for('manage_dispatch') }}" 
               class="flex items-center p-3 rounded-lg 
                      {% if request.endpoint == 'manage_dispatch' %} text-blue-900 bg-blue-200 font-bold {% else %} text-gray-700 hover:bg-blue-100 {% endif %}">
                배차 관리
            </a>
        </nav>
    </div>

    <!-- 메인 컨텐츠 영역 -->
    <div class="flex-1 flex flex-col">
        <header class="admin-header-bg p-4 flex justify-between items-center shadow-md">
            <h2 class="text-xl font-bold text-blue-800">{% block header_title %}페이지 제목{% endblock %}</h2>
            <div>
                <span class="mr-4">{{ session.get('user_name') }}님</span>
                <a href="{{ url_for('logout') }}" class="bg-white text-blue-600 px-4 py-2 rounded-lg shadow hover:bg-gray-100">로그아웃</a>
            </div>
        </header>
        
        <main class="flex-1 p-6">
            <!-- Flash 메시지를 레이아웃에 한 번만 포함하여 중복 문제를 해결합니다 -->
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="mb-4 p-4 rounded-md 
                    {% if category == 'success' %} bg-green-100 text-green-700 
                    {% elif category == 'danger' %} bg-red-100 text-red-700 
                    {% elif category == 'warning' %} bg-yellow-100 text-yellow-700
                    {% else %} bg-blue-100 text-blue-700 {% endif %}"
                    role="alert">
                    {{ message }}
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <!-- 각 페이지의 실제 내용이 이 블록 안으로 들어오게 됩니다. -->
            {% block content %}{% endblock %}
        </main>
    </div>

</body>
</html>